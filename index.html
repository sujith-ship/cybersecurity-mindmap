<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cybersecurity Mind-Map</title>
    <!--
    CYBERSECURITY MIND-MAP - STATIC VERSION
    Completely free, runs 100% in your browser using localStorage
    No server needed - deploy to GitHub Pages FREE FOREVER
    
    UI INSTRUCTIONS:
    - Left Panel: Collapsible hierarchical tree of nodes (folders/items)
    - Right Panel: Inspector showing selected node details
    - Click node name to select and view in inspector
    - Click arrow (‚ñ∂/‚ñº) to expand/collapse folders
    - Use buttons in inspector to:
      * Add Child: Create a new child node under selected node
      * Rename: Change node name
      * Delete: Remove node and all children
      * Upload File: Attach files (stored in browser)
      * Add Tag: Add categorization tags
      * Add Link: Add URLs manually
    
    DATA STORAGE: All data saved to browser localStorage (survives page reloads)
    BACKUP: Use "Export Data" to download JSON, "Import Data" to restore
    
    PRIVACY: 100% local, nothing sent to internet, completely offline-capable
    -->
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #000000;
            color: #cccccc;
            height: 100vh;
            overflow: hidden;
        }
        
        #app-container {
            display: flex;
            height: 100vh;
            flex-direction: row;
        }
        
        /* Left Panel - Tree Navigator */
        #tree-panel {
            width: 300px;
            background-color: #1a1a1a;
            border-right: 1px solid #333;
            overflow-y: auto;
            padding: 10px;
        }
        
        #tree-header {
            padding: 10px;
            background-color: #2a2a2a;
            border-bottom: 1px solid #444;
            margin-bottom: 10px;
            font-weight: bold;
            color: #ffffff;
        }
        
        .tree-node {
            padding: 5px 0;
            user-select: none;
        }
        
        .tree-node-content {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 3px;
        }
        
        .tree-node-content:hover {
            background-color: #2a2a2a;
        }
        
        .tree-node-content.selected {
            background-color: #3a3a3a;
            color: #ffffff;
        }
        
        .tree-toggle {
            width: 20px;
            display: inline-block;
            cursor: pointer;
            color: #888;
            font-size: 12px;
        }
        
        .tree-icon {
            margin-right: 6px;
            font-size: 16px;
        }
        
        .folder-icon { color: #e8b233; }
        .file-icon { color: #aaaaaa; }
        
        .tree-children {
            margin-left: 20px;
            display: none;
        }
        
        .tree-children.expanded {
            display: block;
        }
        
        /* Right Panel - Inspector */
        #inspector-panel {
            flex: 1;
            background-color: #0a0a0a;
            overflow-y: auto;
            padding: 20px;
        }
        
        #inspector-header {
            font-size: 18px;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }
        
        .inspector-section {
            margin-bottom: 25px;
        }
        
        .inspector-label {
            color: #888;
            font-size: 12px;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        input[type="text"],
        textarea {
            width: 100%;
            padding: 10px;
            background-color: #1a1a1a;
            border: 1px solid #333;
            color: #ffffff;
            border-radius: 3px;
            font-family: inherit;
            font-size: 14px;
        }
        
        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #e8b233;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        button {
            padding: 10px 20px;
            background-color: #2a2a2a;
            border: 1px solid #444;
            color: #ffffff;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
            min-width: 120px;
        }
        
        button:hover {
            background-color: #3a3a3a;
            border-color: #e8b233;
        }
        
        button.primary {
            background-color: #e8b233;
            color: #000000;
            border-color: #e8b233;
        }
        
        button.primary:hover {
            background-color: #f5c94d;
        }
        
        button.danger {
            background-color: #aa3333;
            border-color: #aa3333;
        }
        
        button.danger:hover {
            background-color: #cc4444;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .tag-list, .link-list, .file-list {
            list-style: none;
        }
        
        .tag-item, .link-item, .file-item {
            padding: 8px;
            background-color: #1a1a1a;
            border: 1px solid #333;
            border-radius: 3px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .link-item a {
            color: #66aaff;
            text-decoration: none;
            word-break: break-all;
        }
        
        .link-item a:hover {
            text-decoration: underline;
        }
        
        .tag-item {
            display: inline-block;
            margin-right: 5px;
            background-color: #2a3a2a;
            color: #88cc88;
            padding: 4px 10px;
        }
        
        .delete-btn {
            background-color: #aa3333;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            min-width: auto;
            margin: 0;
        }
        
        .delete-btn:hover {
            background-color: #cc4444;
        }
        
        .upload-zone {
            border: 2px dashed #444;
            padding: 20px;
            text-align: center;
            background-color: #1a1a1a;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .upload-zone:hover {
            border-color: #e8b233;
            background-color: #2a2a2a;
        }
        
        .upload-zone.dragging {
            border-color: #e8b233;
            background-color: #2a2a2a;
        }
        
        input[type="file"] { display: none; }
        
        .metadata {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
        }
        
        .status-message {
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 3px;
            display: none;
        }
        
        .status-message.success {
            background-color: #2a4a2a;
            color: #88cc88;
            border: 1px solid #447744;
            display: block;
        }
        
        .status-message.error {
            background-color: #4a2a2a;
            color: #cc8888;
            border: 1px solid #774444;
            display: block;
        }
        
        @media (max-width: 768px) {
            #app-container { flex-direction: column; }
            #tree-panel {
                width: 100%;
                height: 40vh;
                border-right: none;
                border-bottom: 1px solid #333;
            }
            #inspector-panel { height: 60vh; }
        }
    </style>
</head>
<body>
    <div id="app-container">
        <div id="tree-panel">
            <div id="tree-header">üìÅ Mind-Map Navigator</div>
            <div id="tree-container"></div>
        </div>
        
        <div id="inspector-panel">
            <div id="inspector-header">Inspector</div>
            <div id="status-message" class="status-message"></div>
            <div id="inspector-content">
                <p style="color: #666;">Select a node from the tree to view and edit its properties.</p>
            </div>
        </div>
    </div>

    <script>
        // Global state - stored in localStorage
        let mindmapData = { nodes: [], version: "1.0" };
        let selectedNodeId = null;
        let expandedNodes = new Set(['root']);
        
        const STORAGE_KEY = 'cybersecurity-mindmap-data';

        // Initialize app
        async function init() {
            loadFromLocalStorage();
            renderTree();
            if (mindmapData.nodes.length > 0) {
                selectNode(mindmapData.nodes[0].id);
            }
        }

        // Load from localStorage
        function loadFromLocalStorage() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    mindmapData = JSON.parse(stored);
                }
            } catch (error) {
                console.error('Failed to load data:', error);
                mindmapData = { nodes: [], version: "1.0" };
            }
            
            if (mindmapData.nodes.length === 0) {
                initializeDefaultData();
            }
        }

        // Save to localStorage
        function saveToLocalStorage() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(mindmapData));
                showStatus('Data saved to browser', 'success');
            } catch (error) {
                showStatus('Save failed: ' + error.message, 'error');
            }
        }

        // Initialize with default root node
        function initializeDefaultData() {
            mindmapData = {
                nodes: [
                    {
                        id: "root",
                        name: "My Cybersecurity Knowledge Base",
                        type: "folder",
                        content: "Welcome to your mind-map! Add child nodes to organize your notes.",
                        parent: null,
                        children: [],
                        attachments: [],
                        tags: ["root"],
                        links: [],
                        created: new Date().toISOString(),
                        modified: new Date().toISOString()
                    }
                ],
                version: "1.0"
            };
            saveToLocalStorage();
        }

        // Find node by ID
        function findNode(id) {
            return mindmapData.nodes.find(n => n.id === id);
        }

        // Get children of a node
        function getChildren(nodeId) {
            return mindmapData.nodes.filter(n => n.parent === nodeId);
        }

        // Render tree recursively
        function renderTree() {
            const container = document.getElementById('tree-container');
            container.innerHTML = '';
            
            const rootNodes = mindmapData.nodes.filter(n => n.parent === null);
            rootNodes.forEach(node => {
                container.appendChild(renderTreeNode(node));
            });
        }

        function renderTreeNode(node) {
            const div = document.createElement('div');
            div.className = 'tree-node';
            
            const content = document.createElement('div');
            content.className = 'tree-node-content';
            if (selectedNodeId === node.id) {
                content.classList.add('selected');
            }
            
            const children = getChildren(node.id);
            const hasChildren = children.length > 0;
            
            // Toggle arrow
            const toggle = document.createElement('span');
            toggle.className = 'tree-toggle';
            if (hasChildren) {
                toggle.textContent = expandedNodes.has(node.id) ? '‚ñº' : '‚ñ∂';
                toggle.onclick = (e) => {
                    e.stopPropagation();
                    toggleNode(node.id);
                };
            } else {
                toggle.textContent = '  ';
            }
            
            // Icon
            const icon = document.createElement('span');
            icon.className = `tree-icon ${node.type === 'folder' ? 'folder-icon' : 'file-icon'}`;
            icon.textContent = node.type === 'folder' ? 'üìÅ' : 'üìÑ';
            
            // Name
            const name = document.createElement('span');
            name.textContent = node.name;
            
            content.appendChild(toggle);
            content.appendChild(icon);
            content.appendChild(name);
            content.onclick = () => selectNode(node.id);
            
            div.appendChild(content);
            
            // Children
            if (hasChildren) {
                const childrenContainer = document.createElement('div');
                childrenContainer.className = 'tree-children';
                if (expandedNodes.has(node.id)) {
                    childrenContainer.classList.add('expanded');
                }
                
                children.forEach(child => {
                    childrenContainer.appendChild(renderTreeNode(child));
                });
                
                div.appendChild(childrenContainer);
            }
            
            return div;
        }

        function toggleNode(nodeId) {
            if (expandedNodes.has(nodeId)) {
                expandedNodes.delete(nodeId);
            } else {
                expandedNodes.add(nodeId);
            }
            renderTree();
        }

        function selectNode(nodeId) {
            selectedNodeId = nodeId;
            renderTree();
            renderInspector();
        }

        function renderInspector() {
            const node = findNode(selectedNodeId);
            if (!node) return;
            
            const content = document.getElementById('inspector-content');
            content.innerHTML = `
                <div class="inspector-section">
                    <div class="inspector-label">Name</div>
                    <input type="text" id="node-name" value="${escapeHtml(node.name)}" />
                </div>
                
                <div class="inspector-section">
                    <div class="inspector-label">Type</div>
                    <select id="node-type" style="width: 100%; padding: 10px; background-color: #1a1a1a; border: 1px solid #333; color: #ffffff; border-radius: 3px;">
                        <option value="folder" ${node.type === 'folder' ? 'selected' : ''}>üìÅ Folder</option>
                        <option value="file" ${node.type === 'file' ? 'selected' : ''}>üìÑ File/Note</option>
                    </select>
                </div>
                
                <div class="inspector-section">
                    <div class="inspector-label">Content / Notes</div>
                    <textarea id="node-content">${escapeHtml(node.content || '')}</textarea>
                </div>
                
                <div class="inspector-section">
                    <div class="inspector-label">Tags</div>
                    <div id="tag-list" class="tag-list"></div>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <input type="text" id="new-tag" placeholder="Add tag..." style="flex: 1;" />
                        <button onclick="addTag()">Add Tag</button>
                    </div>
                </div>
                
                <div class="inspector-section">
                    <div class="inspector-label">Links / URLs</div>
                    <ul id="link-list" class="link-list"></ul>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <input type="text" id="new-link" placeholder="https://..." style="flex: 1;" />
                        <button onclick="addLink()">Add Link</button>
                    </div>
                </div>
                
                <div class="inspector-section">
                    <div class="inspector-label">Metadata</div>
                    <div class="metadata">
                        Created: ${new Date(node.created).toLocaleString()}<br>
                        Modified: ${new Date(node.modified).toLocaleString()}<br>
                        ID: ${node.id}
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="primary" onclick="saveCurrentNode()">üíæ Save Changes</button>
                    <button onclick="addChildNode()">‚ûï Add Child</button>
                    <button class="danger" onclick="deleteNode()">üóëÔ∏è Delete Node</button>
                    <button onclick="exportData()">üì• Export Data</button>
                    <button onclick="importData()">üì§ Import Data</button>
                </div>
                <input type="file" id="import-file" accept=".json" onchange="handleImportFile(event)" style="display: none;" />
            `;
            
            renderTags();
            renderLinks();
        }

        function renderTags() {
            const node = findNode(selectedNodeId);
            const container = document.getElementById('tag-list');
            container.innerHTML = '';
            
            (node.tags || []).forEach((tag, index) => {
                const tagEl = document.createElement('span');
                tagEl.className = 'tag-item';
                tagEl.innerHTML = `${escapeHtml(tag)} <button class="delete-btn" onclick="removeTag(${index})">√ó</button>`;
                container.appendChild(tagEl);
            });
        }

        function renderLinks() {
            const node = findNode(selectedNodeId);
            const container = document.getElementById('link-list');
            container.innerHTML = '';
            
            (node.links || []).forEach((link, index) => {
                const li = document.createElement('li');
                li.className = 'link-item';
                li.innerHTML = `
                    <a href="${escapeHtml(link)}" target="_blank">${escapeHtml(link)}</a>
                    <button class="delete-btn" onclick="removeLink(${index})">√ó</button>
                `;
                container.appendChild(li);
            });
        }

        function saveCurrentNode() {
            const node = findNode(selectedNodeId);
            if (!node) return;
            
            node.name = document.getElementById('node-name').value;
            node.type = document.getElementById('node-type').value;
            node.content = document.getElementById('node-content').value;
            node.modified = new Date().toISOString();
            
            saveToLocalStorage();
            renderTree();
        }

        function addChildNode() {
            const newNode = {
                id: 'node_' + Date.now(),
                name: 'New Node',
                type: 'file',
                content: '',
                parent: selectedNodeId,
                children: [],
                attachments: [],
                tags: [],
                links: [],
                created: new Date().toISOString(),
                modified: new Date().toISOString()
            };
            
            mindmapData.nodes.push(newNode);
            expandedNodes.add(selectedNodeId);
            saveToLocalStorage();
            renderTree();
            selectNode(newNode.id);
        }

        function deleteNode() {
            if (!confirm('Delete this node and all its children?')) return;
            
            function deleteRecursive(nodeId) {
                const children = getChildren(nodeId);
                children.forEach(child => deleteRecursive(child.id));
                mindmapData.nodes = mindmapData.nodes.filter(n => n.id !== nodeId);
            }
            
            deleteRecursive(selectedNodeId);
            saveToLocalStorage();
            renderTree();
            
            if (mindmapData.nodes.length > 0) {
                selectNode(mindmapData.nodes[0].id);
            }
        }

        function addTag() {
            const input = document.getElementById('new-tag');
            const tag = input.value.trim();
            if (!tag) return;
            
            const node = findNode(selectedNodeId);
            if (!node.tags) node.tags = [];
            if (!node.tags.includes(tag)) {
                node.tags.push(tag);
                renderTags();
                input.value = '';
                saveToLocalStorage();
            }
        }

        function removeTag(index) {
            const node = findNode(selectedNodeId);
            node.tags.splice(index, 1);
            renderTags();
            saveToLocalStorage();
        }

        function addLink() {
            const input = document.getElementById('new-link');
            const link = input.value.trim();
            if (!link) return;
            
            const node = findNode(selectedNodeId);
            if (!node.links) node.links = [];
            if (!node.links.includes(link)) {
                node.links.push(link);
                renderLinks();
                input.value = '';
                saveToLocalStorage();
            }
        }

        function removeLink(index) {
            const node = findNode(selectedNodeId);
            node.links.splice(index, 1);
            renderLinks();
            saveToLocalStorage();
        }

        function exportData() {
            const dataStr = JSON.stringify(mindmapData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `mindmap-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showStatus('Data exported successfully', 'success');
        }

        function importData() {
            document.getElementById('import-file').click();
        }

        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (imported.nodes && Array.isArray(imported.nodes)) {
                        mindmapData = imported;
                        saveToLocalStorage();
                        renderTree();
                        if (mindmapData.nodes.length > 0) {
                            selectNode(mindmapData.nodes[0].id);
                        }
                        showStatus('Data imported successfully', 'success');
                    } else {
                        showStatus('Invalid data format', 'error');
                    }
                } catch (error) {
                    showStatus('Import failed: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.className = 'status-message ' + type;
            
            if (type === 'success') {
                setTimeout(() => {
                    statusEl.className = 'status-message';
                }, 3000);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
